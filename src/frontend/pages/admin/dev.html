<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SoulTribe.chat — Dev Console</title>
  <link rel="stylesheet" href="/css/theme.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/admin-dev.css" />
  <link rel="stylesheet" href="/css/mobile.css" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <link rel="stylesheet" href="/css/components.css" /></head>
<body>
  <!-- Navigation will be loaded here by components.js -->
  <div data-component="navbar"></div>
  <script>
    // Client-side guard: redirect non-admins quickly
    (async function guard(){
      try {
        const t = localStorage.getItem('access_token');
        const r = await fetch('/api/admin/ping', {headers:{'Authorization': t ? 'Bearer '+t : ''}});
        if (!r.ok) { window.location.replace('/'); return; }
      } catch { window.location.replace('/'); }
    })();
  </script>
  <div class="container">
    <h1>SoulTribe.chat — Dev Console</h1>
    <div class="toplinks">
      <a href="/">Welcome</a>
      <a href="/login.html">Login</a>
      <a href="/dashboard.html">Dashboard</a>
      <a href="/admin/stats.html">Stats</a>
      <span class="badge">For troubleshooting & admin only</span>
      <button id="btn-health">Health</button>
      <span id="healthStatus" class="badge">unknown</span>
    </div>

    <section>
      <h2>Auth</h2>
      <form id="authForm" autocomplete="on" class="row">
        <input id="email" name="email" placeholder="email" type="email" autocomplete="username email" />
        <input id="password" name="password" placeholder="password" type="password" autocomplete="current-password" />
        <input id="regDisplayName" name="display_name" placeholder="display_name (for register)" />
        <button type="button" id="btn-register">Register</button>
        <button type="submit" id="btn-login">Login</button>
      </form>
      <div class="row">
        <input id="verifyUserId" placeholder="user_id to verify" />
        <button id="btn-verify">Verify Email</button>
      </div>
      <div class="row small">Token: <span id="tokenPreview">(none)</span></div>
      <div class="row small">Current user_id (from JWT): <span id="currentUserId">(unknown)</span></div>
      <div class="row small">Status: <span id="statusBadge" class="badge">Idle</span></div>
      <div class="row">
        <button id="btn-logout">Logout</button>
      </div>
    </section>

    <section>
      <h2>Profile</h2>
      <div class="row">
        <input id="displayName" placeholder="display_name" />
        <select id="liveTz">
          <option value="">Select timezone (city)</option>
          <option value="Europe/Berlin">Berlin (Europe/Berlin)</option>
          <option value="Europe/Paris">Paris (Europe/Paris)</option>
          <option value="Europe/London">London (Europe/London)</option>
          <option value="America/New_York">New York (America/New_York)</option>
          <option value="America/Los_Angeles">Los Angeles (America/Los_Angeles)</option>
          <option value="America/Sao_Paulo">São Paulo (America/Sao_Paulo)</option>
          <option value="Asia/Tokyo">Tokyo (Asia/Tokyo)</option>
          <option value="Asia/Singapore">Singapore (Asia/Singapore)</option>
          <option value="Australia/Sydney">Sydney (Australia/Sydney)</option>
          <option value="Africa/Johannesburg">Johannesburg (Africa/Johannesburg)</option>
        </select>
        <select id="languagesSelect" multiple size="5" title="Hold Ctrl/Cmd to select multiple">
          <option value="en">English (en)</option>
          <option value="de">German (de)</option>
          <option value="fr">French (fr)</option>
          <option value="es">Spanish (es)</option>
          <option value="it">Italian (it)</option>
          <option value="pt">Portuguese (pt)</option>
          <option value="nl">Dutch (nl)</option>
          <option value="sv">Swedish (sv)</option>
          <option value="no">Norwegian (no)</option>
          <option value="da">Danish (da)</option>
        </select>
        <button id="btn-profile-update">Update Profile</button>
      </div>
      <div class="row small">Requires JWT • languages will overwrite the list when provided</div>
    </section>

    <section>
      <h2>Availability</h2>
      <div class="row">
        <input id="availStartDate" type="date" />
        <select id="availStartHour" title="Start hour (0–23)">
          <option value="0">00:00</option>
          <option value="1">01:00</option>
          <option value="2">02:00</option>
          <option value="3">03:00</option>
          <option value="4">04:00</option>
          <option value="5">05:00</option>
          <option value="6">06:00</option>
          <option value="7">07:00</option>
          <option value="8">08:00</option>
          <option value="9">09:00</option>
          <option value="10">10:00</option>
          <option value="11">11:00</option>
          <option value="12">12:00</option>
          <option value="13">13:00</option>
          <option value="14">14:00</option>
          <option value="15">15:00</option>
          <option value="16">16:00</option>
          <option value="17">17:00</option>
          <option value="18">18:00</option>
          <option value="19">19:00</option>
          <option value="20">20:00</option>
          <option value="21">21:00</option>
          <option value="22">22:00</option>
          <option value="23">23:00</option>
        </select>
        <input id="availEndDate" type="date" />
        <select id="availEndHour" title="End hour (0–23)">
          <option value="0">00:00</option>
          <option value="1">01:00</option>
          <option value="2">02:00</option>
          <option value="3">03:00</option>
          <option value="4">04:00</option>
          <option value="5">05:00</option>
          <option value="6">06:00</option>
          <option value="7">07:00</option>
          <option value="8">08:00</option>
          <option value="9">09:00</option>
          <option value="10">10:00</option>
          <option value="11">11:00</option>
          <option value="12">12:00</option>
          <option value="13">13:00</option>
          <option value="14">14:00</option>
          <option value="15">15:00</option>
          <option value="16">16:00</option>
          <option value="17">17:00</option>
          <option value="18">18:00</option>
          <option value="19">19:00</option>
          <option value="20">20:00</option>
          <option value="21">21:00</option>
          <option value="22">22:00</option>
          <option value="23">23:00</option>
        </select>
        <button id="btn-avail-create">Create Slot</button>
      </div>
      <div class="row small">
        <span id="availUtcHint"></span>
      </div>
      <div class="row">
        <button id="btn-avail-list">List My Slots</button>
        <input id="availDeleteId" placeholder="slot_id" />
        <button id="btn-avail-delete">Delete Slot</button>
      </div>
      <div class="row small">Requires JWT • Must be on full hours and ≥ 1h</div>
    </section>

    <section>
      <h2>Match</h2>
      <div class="row">
        <input id="findUserId" placeholder="user_id for /match/find" />
        <input id="findMinScore" placeholder="min_score (optional)" />
        <input id="findLookahead" placeholder="lookahead_days (optional, default 21)" />
        <input id="findMaxOverlaps" placeholder="max_overlaps (optional, default 5)" />
        <button id="btn-match-find">Find Matches</button>
      </div>
      <div class="row">
        <input id="createA" placeholder="a_user_id" />
        <input id="createB" placeholder="b_user_id" />
        <button id="btn-match-create">Create Match</button>
      </div>
    </section>

    <section>
      <h2>Meetup</h2>
      <div class="row">
        <input id="meetMatchId" placeholder="match_id" />
        <button id="btn-meet-propose">Propose Meetup</button>
      </div>
      <div class="row">
        <input id="meetMeetupId" placeholder="meetup_id" />
        <input id="meetConfirmDt" placeholder="confirmed_dt_utc (e.g. 2025-09-11T18:00:00Z)" />
        <button id="btn-meet-confirm">Confirm Meetup</button>
      </div>
      <div class="row">
        <button id="btn-meet-list">List My Meetups</button>
      </div>
      <div class="row small">Requires JWT</div>
    </section>

    <section>
      <h2>Output</h2>
      <pre id="out"></pre>
    </section>
  </div>

  <script src="/js/app.js"></script>
  <script src="/js/admin/dev.js"></script>
  <!-- Footer will be loaded here by components.js -->
  <div data-component="footer"></div>
</body>
</html>
