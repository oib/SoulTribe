<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="login.page_title">SoulTribe.chat — Login / Register</title>
  <link rel="stylesheet" href="/css/index.css" />
  <link rel="stylesheet" href="/css/theme.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/login.css" />
  <link rel="stylesheet" href="/css/mobile.css" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  

  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/navbar.css" />
</head>
<body>
  <div class="page-preloader" id="page-preloader" aria-hidden="true">
    <div class="page-preloader__spinner" role="presentation"></div>
    <span class="page-preloader__text">Loading SoulTribe…</span>
  </div>
  <!-- Navigation will be loaded here by components.js -->
  <div data-component="navbar"></div>
  
  

  <div class="container">
    <section class="card">
      <h2 data-i18n="login.title">Welcome</h2>
      <p class="muted" data-i18n="login.intro">Login with an existing account or register a new one.</p>
      <form id="authForm" autocomplete="on" class="auth-form">
        <div class="form-fields">
          <label class="visually-hidden" for="email">Email</label>
          <input id="email" name="email" placeholder="email" data-i18n-placeholder="login.email" type="email" autocomplete="username email" />
          <label class="visually-hidden" for="displayName">Display name</label>
          <input id="displayName" name="display_name" placeholder="display name (for register)" data-i18n-placeholder="login.display_name" type="text" autocomplete="nickname" />
          <label class="visually-hidden" for="password">Password</label>
          <input id="password" name="password" placeholder="password" data-i18n-placeholder="login.password" type="password" autocomplete="current-password" />
          <label class="visually-hidden" for="passwordConfirm">Confirm password</label>
          <input id="passwordConfirm" name="password_confirm" placeholder="confirm password (for register)" data-i18n-placeholder="login.confirm_password" type="password" autocomplete="new-password" />
        </div>
        <div class="form-actions">
          <button type="button" id="btn-register" data-i18n="login.register">Register</button>
          <button type="submit" id="btn-login" data-i18n="login.login">Login</button>
          <button type="button" id="btn-reset-request" data-i18n="login.reset_password">Reset Password</button>
          <div id="resend-verification-container" class="hidden">
            <span data-i18n="login.email_not_verified">Email not verified? </span>
            <a href="#" id="btn-resend-verification" data-i18n="login.resend_verification">Resend verification email</a>
          </div>
        </div>
      </form>
      <div class="row muted" data-i18n="login.redirect_hint">After login you will be redirected to your dashboard.</div>
      <div class="row"><button id="btn-go-dashboard" type="button" class="hidden" data-i18n="login.go_dashboard">Go to Dashboard</button></div>
    </section>
  </div>

  <script src="/js/toast.js"></script>
  <script src="/js/app.js"></script>
  <script src="/i18n/i18n.js"></script>
  <script src="/js/components.js"></script>
  <script src="/js/login.js"></script>
  <script>
    (function () {
      function hidePreloader() {
        const preloader = document.getElementById('page-preloader');
        if (!preloader) return;
        preloader.classList.add('page-preloader--hide');
        setTimeout(() => {
          if (preloader && preloader.parentNode) {
            preloader.parentNode.removeChild(preloader);
          }
        }, 450);
      }

      if (document.readyState === 'complete') {
        hidePreloader();
      } else {
        window.addEventListener('load', hidePreloader, { once: true });
      }
    })();
    // Redirect to dashboard if already logged in
    function checkTokenAndRedirect() {
      try {
        const t = localStorage.getItem('access_token');
        if (t) { window.location.href = '/dashboard.html'; }
      } catch {}
    }
    checkTokenAndRedirect();
    // Also offer a manual button if token exists but redirect was blocked
    (function(){
      try {
        const t = localStorage.getItem('access_token');
        if (t) document.getElementById('btn-go-dashboard').style.display = 'inline-block';
        document.getElementById('btn-go-dashboard').onclick = () => window.location.href = '/dashboard.html';
      } catch {}
    })();
    // If query has email/password, login.js will auto-submit; we also watch for token
    const iv = setInterval(() => {
      try {
        if (localStorage.getItem('access_token')) {
          clearInterval(iv);
          window.location.href = '/dashboard.html';
        }
      } catch {}
    }, 300);
  </script>
  <!-- Footer will be loaded here by components.js -->
  <div data-component="footer"></div>
</body>
</html>
