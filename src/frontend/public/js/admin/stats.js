(function(){"use strict";function y(){return localStorage.getItem("access_token")}async function u(t,e={}){const s=y(),n=Object.assign({Accept:"application/json"},e.headers||{});s&&(n.Authorization="Bearer "+s);const r=await fetch(t,Object.assign({},e,{headers:n}));if(!r.ok)throw new Error(`${r.status} ${r.statusText}`);return await r.json()}function o(t,e={},s=[]){const n=document.createElement(t);return Object.entries(e).forEach(([r,a])=>{r==="class"?n.className=a:r==="text"?n.textContent=a:n.setAttribute(r,a)}),s.forEach(r=>n.appendChild(typeof r=="string"?document.createTextNode(r):r)),n}function m(t){const e=document.getElementById("cards");if(!e)return;e.innerHTML="",[{label:"Users (total)",value:t.users},{label:"Users (verified)",value:t.users_verified},{label:"Profiles with full radix",value:t.profiles_with_full_radix},{label:"Availability slots",value:t.slots},{label:"Matches",value:t.matches},{label:"Meetups",value:t.meetups},{label:"AI comments",value:t.ai_comments}].forEach(n=>{var a;const r=o("div",{class:"card stat-card"},[o("div",{class:"stat-label",text:n.label}),o("div",{class:"stat-value",text:String((a=n.value)!=null?a:"-")})]);e.appendChild(r)})}function p(t){const e=document.querySelector("#recentTable tbody"),s=document.getElementById("recentEmpty"),n=document.getElementById("recentFilters");if(!e||!n)return;let r=new Set(Array.from(n.querySelectorAll(".toggle.active")).map(d=>d.dataset.type));function a(){e.innerHTML="";const i=(Array.isArray(t.recent)?t.recent:[]).filter(c=>r.has(c.type)||r.has("other")&&!["user","slot","match","meetup"].includes(c.type));if(i.length===0){s&&(s.style.display="");return}s&&(s.style.display="none"),i.forEach(c=>{const l=o("tr",{},[o("td",{text:c.ts||""}),o("td",{text:c.type||""}),o("td",{text:c.info||""})]);e.appendChild(l)})}n.addEventListener("click",d=>{const i=d.target.closest("button.toggle");if(!i)return;i.dataset.type==="reset"?(n.querySelectorAll("button.toggle").forEach(l=>l.classList.remove("active")),["user","slot","match","meetup"].forEach(l=>{const f=n.querySelector(`button.toggle[data-type="${l}"]`);f&&f.classList.add("active")})):i.classList.toggle("active"),r=new Set(Array.from(n.querySelectorAll(".toggle.active")).map(l=>l.dataset.type)),a()}),a()}function b(t){const e=document.querySelector("#breakdownTable tbody");if(!e)return;e.innerHTML="";const s=t.breakdown||{};Object.entries(s).forEach(([n,r])=>{const a=o("tr",{},[o("td",{text:n}),o("td",{text:String(r)})]);e.appendChild(a)})}async function g(){const t=document.getElementById("cardsError");try{await u("/api/admin/ping");const e=await u("/api/admin/stats");m(e),p(e),b(e)}catch(e){console.error("Failed to load admin stats:",e),t&&(t.style.display="",t.textContent="Failed to load stats. Are you logged in as admin?")}}document.addEventListener("DOMContentLoaded",g)})();
