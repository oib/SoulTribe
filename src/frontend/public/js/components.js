async function initializeComponents(){try{try{if(window.SimpleI18n){const t=window.SimpleI18n.currentLang||"en";!!(window.SimpleI18n.translations&&window.SimpleI18n.translations[t])||await window.SimpleI18n.init()}}catch(t){console.warn("i18n init in components failed (continuing):",t)}await loadComponents(),initMobileMenu(),initLanguageSelector("language-selector"),initLanguageSelector("footer-language-selector")}catch(t){console.error("Error initializing components:",t)}}function scheduleComponentInit(){document.readyState==="complete"?initializeComponents():window.addEventListener("load",initializeComponents,{once:!0})}scheduleComponentInit(),document.addEventListener("componentLoaded",t=>{t.detail.component==="navbar"&&(initMobileMenu(),initLanguageSelector("language-selector"))});async function loadComponents(){const t=document.querySelectorAll("[data-component]");for(const e of t){const o=e.getAttribute("data-component");try{const s=window.APP_BUILD_VERSION||Date.now(),a=await fetch(`/components/${o}.html?v=${s}`);if(!a.ok)throw new Error(`Failed to load component: ${o}`);const r=await a.text();if(r&&r.trim()){e.innerHTML=r;const c=e.querySelectorAll("script");Array.from(c).forEach(n=>{if(!n||!n.parentNode)return;const i=document.createElement("script");for(const l of n.attributes)i.setAttribute(l.name,l.value);n.src||(i.textContent=n.textContent);try{n.parentNode.replaceChild(i,n)}catch(l){console.warn("Failed to replace script in component:",l)}});try{window.SimpleI18n&&typeof window.SimpleI18n.updateUI=="function"&&window.SimpleI18n.updateUI()}catch(n){}if(e.dispatchEvent(new CustomEvent("componentLoaded",{detail:{component:o,element:e}})),o==="navbar"){if(initMobileMenu(),initLanguageSelector("language-selector"),typeof window.updateNavbarAuthUI=="function")try{window.updateNavbarAuthUI()}catch(n){console.warn("updateNavbarAuthUI error:",n)}else if(typeof window.updateAuthState=="function")try{window.updateAuthState()}catch(n){console.warn("updateAuthState error:",n)}}else o==="footer"&&initLanguageSelector("footer-language-selector")}else console.warn(`Empty component: ${o}`),e.innerHTML=`<!-- Empty component: ${o} -->`}catch(s){console.error(`Error loading component ${o}:`,s),e.innerHTML=`<!-- Error loading component: ${o} -->`}}}function initMobileMenu(){const t=document.querySelector(".navbar-toggle"),e=document.querySelector(".navbar-menu"),o=document.querySelector(".navbar-menu-close");if(t&&e){if(t.dataset.bound==="true")return;const s=()=>{e.classList.remove("active"),t.classList.remove("active"),t.setAttribute("aria-expanded","false"),document.body.classList.remove("navbar-menu-open")};t.addEventListener("click",()=>{const a=e.classList.toggle("active");t.classList.toggle("active",a),t.setAttribute("aria-expanded",a?"true":"false"),document.body.classList.toggle("navbar-menu-open",a)}),o&&o.addEventListener("click",()=>s()),e.querySelectorAll("a, button").forEach(a=>{a.addEventListener("click",()=>s())}),t.dataset.bound="true"}}async function initLanguageSelector(t){const e=document.getElementById(t);if(!e)return;let o=!1;async function s(){if(!e||!window.SimpleI18n)return;const a=await window.SimpleI18n.detectSupportedLanguages(),r=window.SimpleI18n.currentLang||"en",c=Object.entries(window.SimpleI18n.languages||{}).filter(([n])=>a.includes(n));if(c.length===0){e.innerHTML='<option value="en" selected>English</option>';return}c.sort((n,i)=>n[1].localeCompare(i[1],void 0,{sensitivity:"base"})),e.innerHTML=c.map(([n,i])=>`<option value="${n}" ${n===r?"selected":""}>${i}</option>`).join("")}await s(),e.addEventListener("change",async a=>{var n;if(o)return;const r=a.target.value,c=(n=window.SimpleI18n)==null?void 0:n.currentLang;if(!(!r||r===c)){o=!0,document.querySelectorAll(".language-selector").forEach(i=>{i.disabled=!0});try{if(!await window.SimpleI18n.changeLanguage(r))document.querySelectorAll(".language-selector").forEach(l=>{l.value=c||"en"}),toast(`Failed to load ${r} translations. Using ${c||"English"} instead.`,"error");else{if(document.querySelectorAll(".language-selector").forEach(u=>{u!==e&&(u.value=r)}),window.SimpleI18n&&typeof window.SimpleI18n.updateUI=="function")try{window.SimpleI18n.updateUI()}catch(u){}const l=window.SimpleI18n.languages[r]||r;typeof toast=="function"&&toast(`Language changed to ${l}`,"success")}}catch(i){console.error("Error changing language:",i),document.querySelectorAll(".language-selector").forEach(l=>{l.value=c||"en"}),typeof toast=="function"?toast("An error occurred while changing the language.","error"):console.error("An error occurred while changing the language.")}finally{document.querySelectorAll(".language-selector").forEach(i=>{i.disabled=!1}),o=!1}}}),window.addEventListener("languageChanged",async a=>{var r;if((r=a.detail)!=null&&r.language&&e.value!==a.detail.language&&(e.value=a.detail.language,await s(),window.SimpleI18n&&typeof window.SimpleI18n.updateUI=="function"))try{window.SimpleI18n.updateUI()}catch(c){}})}
