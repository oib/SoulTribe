<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SoulTribe.chat — Dashboard</title>
  <link rel="stylesheet" href="/theme.css" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/dashboard.css" />
  <link rel="stylesheet" href="/mobile.css" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  
</head>
<body>
  <div class="topbar">
    <div class="brand"><a href="/" class="link-unstyled"><strong>SoulTribe.chat</strong></a></div>
    <div>
      <a id="btn-profile-link" class="button hidden" href="/profile.html" data-i18n="nav.profile">Profile</a>
      <a id="btn-login-link" class="button secondary hidden" href="/login.html" data-i18n="nav.login">Login</a>
      <button id="btn-logout" class="button hidden" data-i18n="nav.logout">Logout</button>
      <a id="btn-admin-link" class="button secondary" href="/admin/stats.html" style="display:none;">Admin</a>
    </div>
  </div>

  

  <div class="two-col">
  <section class="card">
    <div class="card-head" style="display:flex; align-items:center; gap:12px;">
      <h2 data-i18n="dashboard.availability">Availability</h2>
    </div>
    <div class="avail-grid">
      <div class="avail-group">
        <input id="availStartDate" type="date" />
        <select id="availStartHour" title="Start hour (0–23)">
          <option value="0">00:00</option>
          <option value="1">01:00</option>
          <option value="2">02:00</option>
          <option value="3">03:00</option>
          <option value="4">04:00</option>
          <option value="5">05:00</option>
          <option value="6">06:00</option>
          <option value="7">07:00</option>
          <option value="8">08:00</option>
          <option value="9">09:00</option>
          <option value="10">10:00</option>
          <option value="11">11:00</option>
          <option value="12">12:00</option>
          <option value="13">13:00</option>
          <option value="14">14:00</option>
          <option value="15">15:00</option>
          <option value="16">16:00</option>
          <option value="17">17:00</option>
          <option value="18">18:00</option>
          <option value="19">19:00</option>
          <option value="20">20:00</option>
          <option value="21">21:00</option>
          <option value="22">22:00</option>
          <option value="23">23:00</option>
        </select>
      </div>
      <div class="avail-group">
        <select id="availDurationHours" data-i18n-title="dashboard.duration_hours" title="Duration (hours)">
          <option value="1">1 hour</option>
          <option value="2">2 hours</option>
          <option value="3">3 hours</option>
        </select>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <button id="btn-avail-create" class="primary" data-i18n="dashboard.create_slot">Create Slot</button>
    </div>
    <div class="row muted">
      <span id="availUtcHint"></span>
    </div>
    <ul id="availList"></ul>
  </section>

  <section class="card">
    <h2 data-i18n="dashboard.meetups">Meetups</h2>
    <div id="meetups"></div>
  </section>

  <section class="card">
    <h2 data-i18n="dashboard.matches">Matches</h2>
    <div class="muted" data-i18n="dashboard.overlap_hint">Click “Propose this time” on an overlap to propose a meetup for that slot.</div>
    <div id="matches"></div>
  </section>
  </div>

  <script src="/app.js"></script>
  <script src="/i18n/i18n.js"></script>
  <script src="/dashboard.js"></script>
  <script>
    // Redirect back to login if no token
    (function ensureAuth(){
      try {
        const t = localStorage.getItem('access_token');
        const showLogin = !t;
        document.getElementById('btn-login-link').style.display = showLogin ? 'inline-block' : 'none';
        document.getElementById('btn-logout').style.display = showLogin ? 'none' : 'inline-block';
        const prof = document.getElementById('btn-profile-link');
        if (prof) prof.style.display = showLogin ? 'none' : 'inline-block';
        if (!t) window.location.href = '/login.html';
      } catch {}
    })();

    // Show Admin link only for admins/localhost
    (async function showAdmin(){
      try {
        const t = localStorage.getItem('access_token');
        const r = await fetch('/api/admin/ping', {headers:{'Authorization': t ? 'Bearer '+t : ''}});
        if (r.ok) {
          var el = document.getElementById('btn-admin-link'); if (el) el.style.display='inline-block';
        }
      } catch {}
    })();
  </script>
</body>
</html>
